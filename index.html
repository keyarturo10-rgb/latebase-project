<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Late Base - Gestor de Distribuidores de Café</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2E8B57;
            --primary-light: #E8F5E9;
            --primary-dark: #1B5E20;
            --secondary: #795548;
            --accent: #FF9800;
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-tertiary: #9E9E9E;
            --divider: #E0E0E0;
            --background: #FAFAFA;
            --surface: #FFFFFF;
            --error: #D32F2F;
            --success: #388E3C;
            --warning: #F57C00;
            --info: #1976D2;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.12), 0 1px 3px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1), 0 5px 10px rgba(0,0,0,0.05);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-mode {
            --text-primary: #F5F5F5;
            --text-secondary: #E0E0E0;
            --text-tertiary: #9E9E9E;
            --divider: #424242;
            --background: #121212;
            --surface: #1E1E1E;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.4), 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.4), 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.3), 0 5px 10px rgba(0,0,0,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            color: var(--text-primary);
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header Styles */
        header {
            background-color: var(--surface);
            padding: 16px 0;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-svg {
            width: 48px;
            height: 48px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            color: var(--primary);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 8px;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        nav a:hover, nav a.active {
            color: var(--primary);
            background-color: var(--primary-light);
        }

        nav a.active {
            color: var(--primary);
            background-color: var(--primary-light);
        }

        /* Main Content */
        main {
            padding: 32px 0;
            min-height: calc(100vh - 180px);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--divider);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .section-actions {
            display: flex;
            gap: 12px;
        }

        /* Search & Filters */
        .search-filters {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            margin-bottom: 24px;
            background-color: var(--surface);
            padding: 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .search-bar {
            display: flex;
            gap: 12px;
        }

        .search-bar input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid var(--divider);
            border-radius: var(--radius-sm);
            font-family: 'Inter', sans-serif;
            background-color: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.2);
        }

        .filters {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-select {
            padding: 12px 16px;
            border: 1px solid var(--divider);
            border-radius: var(--radius-sm);
            background-color: var(--surface);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: var(--transition);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background-color: var(--surface);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--divider);
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 20px 20px 16px;
            border-bottom: 1px solid var(--divider);
            position: relative;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--primary-light);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .card-body {
            padding: 20px;
            flex-grow: 1;
        }

        .card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .card-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .detail-value {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .coffees-list {
            margin-top: 16px;
        }

        .coffees-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coffee-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .coffee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background-color: var(--background);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .coffee-item:hover {
            background-color: var(--primary-light);
        }

        .coffee-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .coffee-score {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .coffee-score i {
            color: var(--accent);
        }

        .card-footer {
            padding: 16px 20px;
            background-color: var(--background);
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--divider);
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--divider);
        }

        .btn-secondary:hover {
            background-color: var(--background);
            color: var(--text-primary);
        }

        .btn-danger {
            background-color: transparent;
            color: var(--error);
            border: 1px solid var(--divider);
        }

        .btn-danger:hover {
            background-color: rgba(211, 47, 47, 0.1);
        }

        .btn-icon {
            padding: 10px;
            border-radius: 50%;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--divider);
            border-radius: var(--radius-sm);
            font-family: 'Inter', sans-serif;
            background-color: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.2);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: var(--surface);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 16px;
            border-bottom: 1px solid var(--divider);
        }

        .modal-header h2 {
            font-weight: 600;
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        /* GitHub Config */
        .github-config {
            background-color: var(--surface);
            padding: 24px;
            border-radius: var(--radius-md);
            margin-bottom: 24px;
            border: 1px solid var(--divider);
            transition: var(--transition);
        }

        .github-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .github-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-connected {
            background-color: var(--success);
            box-shadow: 0 0 0 3px rgba(56, 142, 60, 0.2);
        }

        .status-disconnected {
            background-color: var(--error);
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.2);
        }

        /* Tabs */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Footer */
        footer {
            background-color: var(--surface);
            color: var(--text-secondary);
            text-align: center;
            padding: 24px 0;
            margin-top: 32px;
            border-top: 1px solid var(--divider);
            transition: var(--transition);
        }

        /* Coffee Detail View */
        .coffee-detail-view {
            display: none;
            margin-top: 24px;
            background-color: var(--surface);
            border-radius: var(--radius-md);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--divider);
        }

        .coffee-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .coffee-detail-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .coffee-detail-subtitle {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .coffee-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .coffee-detail-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .coffee-detail-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .coffee-detail-value {
            font-size: 1rem;
            font-weight: 500;
        }

        .coffee-detail-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-wrap: wrap;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .section-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .coffee-detail-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 16px;
            }
            
            .modal-content {
                padding: 16px;
            }
            
            .card-details {
                grid-template-columns: 1fr;
            }
            
            .coffee-detail-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10,30 Q25,10 40,30 T70,30 T100,30" stroke="#2E8B57" stroke-width="3" fill="none" />
                        <path d="M10,45 Q25,25 40,45 T70,45 T100,45" stroke="#2E8B57" stroke-width="3" fill="none" />
                        <path d="M10,60 Q25,40 40,60 T70,60 T100,60" stroke="#2E8B57" stroke-width="3" fill="none" />
                        <path d="M10,75 Q25,55 40,75 T70,75 T100,75" stroke="#2E8B57" stroke-width="3" fill="none" />
                        <circle cx="50" cy="52" r="8" fill="#2E8B57" opacity="0.8" />
                    </svg>
                    <h1>Late Base</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="active" data-tab="distributors"><i class="fas fa-store"></i> Distribuidores</a></li>
                        <li><a href="#" data-tab="coffees"><i class="fas fa-coffee"></i> Cafés</a></li>
                        <li><a href="#" data-tab="github-config"><i class="fab fa-github"></i> GitHub</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section id="distributors" class="tab-content active">
            <div class="section-header">
                <h2 class="section-title">Gestión de Distribuidores</h2>
                <div class="section-actions">
                    <button class="btn btn-secondary btn-sm" id="btn-export-data"><i class="fas fa-download"></i> Exportar</button>
                    <button class="btn btn-primary" id="btn-add-distributor"><i class="fas fa-plus"></i> Agregar Distribuidor</button>
                </div>
            </div>
            
            <div class="search-filters">
                <div class="search-bar">
                    <input type="text" id="search-distributors" placeholder="Buscar distribuidores...">
                    <button class="btn btn-primary" id="btn-search-distributors"><i class="fas fa-search"></i></button>
                </div>
                <div class="filters">
                    <select class="filter-select" id="filter-country">
                        <option value="">Todos los países</option>
                    </select>
                    <select class="filter-select" id="filter-region">
                        <option value="">Todas las regiones</option>
                    </select>
                </div>
            </div>
            
            <div class="github-config">
                <div class="github-config-header">
                    <div class="github-status">
                        <span class="status-indicator status-disconnected" id="github-status"></span>
                        <span id="github-status-text">No conectado a GitHub</span>
                    </div>
                    <button class="btn btn-primary" id="btn-sync-now"><i class="fas fa-sync"></i> Sincronizar ahora</button>
                </div>
            </div>
            
            <div class="cards-grid" id="distributors-grid"></div>

            <div class="coffee-detail-view" id="coffee-detail-view">
                <div class="coffee-detail-header">
                    <div>
                        <h3 class="coffee-detail-title" id="detail-coffee-name"></h3>
                        <p class="coffee-detail-subtitle" id="detail-coffee-origin"></p>
                    </div>
                    <button class="btn btn-icon btn-secondary" id="btn-close-detail"><i class="fas fa-times"></i></button>
                </div>
                
                <div class="coffee-detail-grid">
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Variedad</span>
                        <span class="coffee-detail-value" id="detail-coffee-variety"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Proceso</span>
                        <span class="coffee-detail-value" id="detail-coffee-process"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Altitud</span>
                        <span class="coffee-detail-value" id="detail-coffee-altitude"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Nivel de tostión</span>
                        <span class="coffee-detail-value" id="detail-coffee-roast"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Puntuación SCA</span>
                        <span class="coffee-detail-value" id="detail-coffee-sca"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Precio 250g</span>
                        <span class="coffee-detail-value" id="detail-coffee-price-250"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Precio 500g</span>
                        <span class="coffee-detail-value" id="detail-coffee-price-500"></span>
                    </div>
                    <div class="coffee-detail-item">
                        <span class="coffee-detail-label">Precio 1kg</span>
                        <span class="coffee-detail-value" id="detail-coffee-price-1kg"></span>
                    </div>
                </div>
                
                <div class="coffee-detail-item">
                    <span class="coffee-detail-label">Notas de cata</span>
                    <p class="coffee-detail-value" id="detail-coffee-tasting"></p>
                </div>
                
                <div class="coffee-detail-actions">
                    <button class="btn btn-secondary" id="btn-edit-coffee-from-detail">Editar Café</button>
                </div>
            </div>
        </section>

        <section id="coffees" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Gestión de Cafés</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" id="btn-add-coffee"><i class="fas fa-plus"></i> Agregar Café</button>
                </div>
            </div>
            
            <div class="search-filters">
                <div class="search-bar">
                    <input type="text" id="search-coffees" placeholder="Buscar cafés...">
                    <button class="btn btn-primary" id="btn-search-coffees"><i class="fas fa-search"></i></button>
                </div>
                <div class="filters">
                    <select class="filter-select" id="filter-distributor">
                        <option value="">Todos los distribuidores</option>
                    </select>
                    <select class="filter-select" id="filter-process">
                        <option value="">Todos los procesos</option>
                        <option value="Lavado">Lavado</option>
                        <option value="Natural">Natural</option>
                        <option value="Honey">Honey</option>
                        <option value="Anaerobic">Anaeróbico</option>
                    </select>
                </div>
            </div>
            
            <div class="cards-grid" id="coffees-grid"></div>
        </section>

        <section id="github-config" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Configuración de GitHub</h2>
            </div>
            
            <form id="github-config-form">
                <div class="form-group">
                    <label for="github-user">Usuario de GitHub</label>
                    <input type="text" id="github-user" class="form-control" value="keyarturo10-rgb" required>
                </div>
                
                <div class="form-group">
                    <label for="github-repo">Repositorio</label>
                    <input type="text" id="github-repo" class="form-control" value="latebase-project" required>
                </div>
                
                <div class="form-group">
                    <label for="github-branch">Rama</label>
                    <input type="text" id="github-branch" class="form-control" value="main" required>
                </div>
                
                <div class="form-group">
                    <label for="github-token">Token de acceso</label>
                    <input type="password" id="github-token" class="form-control" required>
                    <small>Necesitas generar un token personal en GitHub con permisos de repositorio</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="github-auto-sync"> Sincronización automática
                    </label>
                </div>
                
                <div class="form-group" id="sync-interval-container">
                    <label for="sync-interval">Intervalo de sincronización (minutos)</label>
                    <input type="number" id="sync-interval" class="form-control" min="1" max="60" value="5">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="btn-test-connection">Probar conexión</button>
                    <button type="submit" class="btn btn-primary">Guardar configuración</button>
                </div>
            </form>
        </section>
    </main>

    <!-- Modals -->
    <div class="modal" id="distributor-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="distributor-modal-title">Agregar Distribuidor</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="distributor-form">
                    <input type="hidden" id="distributor-id">
                    <div class="form-group">
                        <label for="distributor-name">Nombre</label>
                        <input type="text" id="distributor-name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="distributor-country">País</label>
                        <input type="text" id="distributor-country" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="distributor-region">Región</label>
                        <input type="text" id="distributor-region" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="distributor-contact">Contacto</label>
                        <input type="text" id="distributor-contact" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="distributor-description">Descripción</label>
                        <textarea id="distributor-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal" id="coffee-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="coffee-modal-title">Agregar Café</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="coffee-form">
                    <input type="hidden" id="coffee-id">
                    <div class="form-group">
                        <label for="coffee-distributor">Distribuidor</label>
                        <select id="coffee-distributor" class="form-control" required>
                            <option value="">Seleccionar distribuidor</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-name">Nombre</label>
                        <input type="text" id="coffee-name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-origin">Origen</label>
                        <input type="text" id="coffee-origin" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-altitude">Altitud (msnm)</label>
                        <input type="number" id="coffee-altitude" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-variety">Variedad</label>
                        <input type="text" id="coffee-variety" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-process">Proceso</label>
                        <select id="coffee-process" class="form-control" required>
                            <option value="Lavado">Lavado</option>
                            <option value="Natural">Natural</option>
                            <option value="Honey">Honey</option>
                            <option value="Anaerobic">Anaeróbico</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-roast">Nivel de tostión</label>
                        <select id="coffee-roast" class="form-control" required>
                            <option value="Claro">Claro</option>
                            <option value="Medio">Medio</option>
                            <option value="Medio-Oscuro">Medio-Oscuro</option>
                            <option value="Oscuro">Oscuro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-sca">Puntuación SCA (0-100)</label>
                        <input type="number" id="coffee-sca" class="form-control" min="0" max="100" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-tasting">Notas de cata</label>
                        <textarea id="coffee-tasting" class="form-control" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-price-250">Precio 250g (€)</label>
                        <input type="number" id="coffee-price-250" class="form-control" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-price-500">Precio 500g (€)</label>
                        <input type="number" id="coffee-price-500" class="form-control" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="coffee-price-1kg">Precio 1kg (€)</label>
                        <input type="number" id="coffee-price-1kg" class="form-control" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Late Base - Gestor de Distribuidores de Café &copy; 2023</p>
        </div>
    </footer>

    <script>
        // Data structures
        let distributors = [];
        let coffees = [];
        let githubConfig = {
            user: 'keyarturo10-rgb',
            repo: 'latebase-project',
            branch: 'main',
            token: '',
            autoSync: false,
            syncInterval: 5
        };
        let syncIntervalId = null;
        let currentCoffeeDetailId = null;

        // DOM Elements
        const distributorsGrid = document.getElementById('distributors-grid');
        const coffeesGrid = document.getElementById('coffees-grid');
        const distributorForm = document.getElementById('distributor-form');
        const coffeeForm = document.getElementById('coffee-form');
        const githubConfigForm = document.getElementById('github-config-form');
        const distributorModal = document.getElementById('distributor-modal');
        const coffeeModal = document.getElementById('coffee-modal');
        const githubStatus = document.getElementById('github-status');
        const githubStatusText = document.getElementById('github-status-text');
        const autoSyncToggle = document.getElementById('github-auto-sync');
        const syncIntervalContainer = document.getElementById('sync-interval-container');
        const themeToggle = document.getElementById('theme-toggle');
        const coffeeDetailView = document.getElementById('coffee-detail-view');
        const btnCloseDetail = document.getElementById('btn-close-detail');
        const btnEditCoffeeFromDetail = document.getElementById('btn-edit-coffee-from-detail');

        // Utility functions
        const $ = (selector, context = document) => context.querySelector(selector);
        const $$ = (selector, context = document) => context.querySelectorAll(selector);

        // Initialize application
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            loadData();
            setupEventListeners();
            renderDistributors();
            renderCoffees();
            setupTabs();
            loadGithubConfig();
            updateGithubStatus();
            updateFilterOptions();
        }

        function setupEventListeners() {
            // Navigation tabs
            $$('nav a').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = tab.getAttribute('data-tab');
                    activateTab(tabName);
                });
            });

            // Modal close buttons
            $$('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    distributorModal.style.display = 'none';
                    coffeeModal.style.display = 'none';
                });
            });

            // Add distributor button
            $('#btn-add-distributor').addEventListener('click', () => {
                openDistributorModal();
            });

            // Add coffee button
            $('#btn-add-coffee').addEventListener('click', () => {
                openCoffeeModal();
            });

            // Form submissions
            distributorForm.addEventListener('submit', handleDistributorSubmit);
            coffeeForm.addEventListener('submit', handleCoffeeSubmit);
            githubConfigForm.addEventListener('submit', handleGithubConfigSubmit);

            // GitHub functionality
            $('#btn-test-connection').addEventListener('click', testGithubConnection);
            $('#btn-sync-now').addEventListener('click', syncWithGithub);

            // Auto sync toggle
            autoSyncToggle.addEventListener('change', () => {
                syncIntervalContainer.style.display = autoSyncToggle.checked ? 'block' : 'none';
            });

            // Search functionality
            $('#btn-search-distributors').addEventListener('click', searchDistributors);
            $('#btn-search-coffees').addEventListener('click', searchCoffees);

            // Filter functionality
            $('#filter-country').addEventListener('change', filterDistributors);
            $('#filter-region').addEventListener('change', filterDistributors);
            $('#filter-distributor').addEventListener('change', filterCoffees);
            $('#filter-process').addEventListener('change', filterCoffees);

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Coffee detail view
            btnCloseDetail.addEventListener('click', () => {
                coffeeDetailView.style.display = 'none';
            });

            btnEditCoffeeFromDetail.addEventListener('click', () => {
                if (currentCoffeeDetailId) {
                    openCoffeeModal(currentCoffeeDetailId);
                    coffeeDetailView.style.display = 'none';
                }
            });

            // Event delegation for dynamic content
            distributorsGrid.addEventListener('click', handleDistributorActions);
            coffeesGrid.addEventListener('click', handleCoffeeActions);
            
            // Export data
            $('#btn-export-data').addEventListener('click', exportData);
        }

        function handleDistributorActions(e) {
            const target = e.target;
            if (target.classList.contains('edit-distributor')) {
                const id = target.getAttribute('data-id');
                openDistributorModal(id);
            } else if (target.classList.contains('delete-distributor')) {
                const id = target.getAttribute('data-id');
                deleteDistributor(id);
            } else if (target.classList.contains('view-coffee')) {
                const id = target.getAttribute('data-id');
                showCoffeeDetail(id);
            }
        }

        function handleCoffeeActions(e) {
            const target = e.target;
            if (target.classList.contains('edit-coffee')) {
                const id = target.getAttribute('data-id');
                openCoffeeModal(id);
            } else if (target.classList.contains('delete-coffee')) {
                const id = target.getAttribute('data-id');
                deleteCoffee(id);
            } else if (target.classList.contains('view-coffee')) {
                const id = target.getAttribute('data-id');
                showCoffeeDetail(id);
            }
        }

        function setupTabs() {
            $$('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            $('.tab-content.active').style.display = 'block';
        }

        function activateTab(tabName) {
            // Update navigation
            $$('nav a').forEach(tab => {
                tab.classList.remove('active');
            });
            $(`nav a[data-tab="${tabName}"]`).classList.add('active');

            // Update content
            $$('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            $(`#${tabName}`).style.display = 'block';
        }

        function loadData() {
            // Load from localStorage or initialize with empty arrays
            const savedDistributors = localStorage.getItem('latebase-distributors');
            const savedCoffees = localStorage.getItem('latebase-coffees');
            
            distributors = savedDistributors ? JSON.parse(savedDistributors) : [];
            coffees = savedCoffees ? JSON.parse(savedCoffees) : [];
        }

        function saveData() {
            localStorage.setItem('latebase-distributors', JSON.stringify(distributors));
            localStorage.setItem('latebase-coffees', JSON.stringify(coffees));
            
            // Update filter options
            updateFilterOptions();
            
            // Trigger auto sync if enabled
            if (githubConfig.autoSync) {
                syncWithGithub();
            }
        }

        function loadGithubConfig() {
            const savedConfig = localStorage.getItem('latebase-github-config');
            if (savedConfig) {
                githubConfig = JSON.parse(savedConfig);
                
                // Update form fields
                $('#github-user').value = githubConfig.user;
                $('#github-repo').value = githubConfig.repo;
                $('#github-branch').value = githubConfig.branch;
                $('#github-token').value = githubConfig.token;
                $('#github-auto-sync').checked = githubConfig.autoSync;
                $('#sync-interval').value = githubConfig.syncInterval;
                
                syncIntervalContainer.style.display = githubConfig.autoSync ? 'block' : 'none';
                
                // Setup auto sync if enabled
                if (githubConfig.autoSync) {
                    setupAutoSync();
                }
            }
        }

        function saveGithubConfig() {
            localStorage.setItem('latebase-github-config', JSON.stringify(githubConfig));
            
            // Update auto sync
            if (syncIntervalId) {
                clearInterval(syncIntervalId);
            }
            
            if (githubConfig.autoSync) {
                setupAutoSync();
            }
            
            updateGithubStatus();
        }

        function setupAutoSync() {
            const interval = githubConfig.syncInterval * 60 * 1000; // Convert to milliseconds
            if (syncIntervalId) {
                clearInterval(syncIntervalId);
            }
            syncIntervalId = setInterval(syncWithGithub, interval);
        }

        function updateGithubStatus() {
            if (githubConfig.token) {
                githubStatus.className = 'status-indicator status-connected';
                githubStatusText.textContent = 'Conectado a GitHub';
            } else {
                githubStatus.className = 'status-indicator status-disconnected';
                githubStatusText.textContent = 'No conectado a GitHub';
            }
        }

        function updateFilterOptions() {
            // Update country filter
            const countryFilter = $('#filter-country');
            const currentCountry = countryFilter.value;
            countryFilter.innerHTML = '<option value="">Todos los países</option>';
            
            const countries = [...new Set(distributors.map(d => d.country))].sort();
            countries.forEach(country => {
                countryFilter.innerHTML += `<option value="${country}">${escapeHTML(country)}</option>`;
            });
            
            if (countries.includes(currentCountry)) {
                countryFilter.value = currentCountry;
            }
            
            // Update region filter
            const regionFilter = $('#filter-region');
            const currentRegion = regionFilter.value;
            regionFilter.innerHTML = '<option value="">Todas las regiones</option>';
            
            const regions = [...new Set(distributors.map(d => d.region))].sort();
            regions.forEach(region => {
                regionFilter.innerHTML += `<option value="${region}">${escapeHTML(region)}</option>`;
            });
            
            if (regions.includes(currentRegion)) {
                regionFilter.value = currentRegion;
            }
            
            // Update distributor filter
            const distributorFilter = $('#filter-distributor');
            const currentDistributor = distributorFilter.value;
            distributorFilter.innerHTML = '<option value="">Todos los distribuidores</option>';
            
            distributors.forEach(distributor => {
                distributorFilter.innerHTML += `<option value="${distributor.id}">${escapeHTML(distributor.name)}</option>`;
            });
            
            if (distributors.some(d => d.id === currentDistributor)) {
                distributorFilter.value = currentDistributor;
            }
        }

        function renderDistributors(filteredDistributors = null) {
            const data = filteredDistributors || distributors;
            distributorsGrid.innerHTML = '';
            
            if (data.length === 0) {
                distributorsGrid.innerHTML = '<p class="no-results">No hay distribuidores registrados.</p>';
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            data.forEach(distributor => {
                const distributorCoffees = coffees.filter(coffee => coffee.distributorId === distributor.id);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-title">${escapeHTML(distributor.name)}</h3>
                        <div class="card-subtitle">
                            <i class="fas fa-map-marker-alt"></i>
                            ${escapeHTML(distributor.region)}, ${escapeHTML(distributor.country)}
                        </div>
                        <div class="card-badge">${distributorCoffees.length} café${distributorCoffees.length !== 1 ? 's' : ''}</div>
                    </div>
                    <div class="card-body">
                        <div class="card-details">
                            <div class="card-detail">
                                <span class="detail-label">Contacto</span>
                                <span class="detail-value">${escapeHTML(distributor.contact)}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">País</span>
                                <span class="detail-value">${escapeHTML(distributor.country)}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">Región</span>
                                <span class="detail-value">${escapeHTML(distributor.region)}</span>
                            </div>
                        </div>
                        ${distributor.description ? `<p>${escapeHTML(distributor.description)}</p>` : ''}
                        
                        ${distributorCoffees.length > 0 ? `
                        <div class="coffees-list">
                            <div class="coffees-title">
                                <i class="fas fa-coffee"></i>
                                Cafés de este productor
                            </div>
                            <div class="coffee-items">
                                ${distributorCoffees.slice(0, 3).map(coffee => `
                                    <div class="coffee-item">
                                        <span class="coffee-name">${escapeHTML(coffee.name)}</span>
                                        <span class="coffee-score">
                                            <i class="fas fa-star"></i>
                                            ${coffee.scaScore}
                                        </span>
                                    </div>
                                `).join('')}
                                ${distributorCoffees.length > 3 ? `
                                    <div class="coffee-item">
                                        <span class="coffee-name">+${distributorCoffees.length - 3} más</span>
                                        <button class="btn btn-sm btn-secondary view-coffee" data-id="${distributor.id}">Ver todos</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-sm btn-primary edit-distributor" data-id="${distributor.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-sm btn-danger delete-distributor" data-id="${distributor.id}">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                fragment.appendChild(card);
            });
            
            distributorsGrid.appendChild(fragment);
        }

        function renderCoffees(filteredCoffees = null) {
            const data = filteredCoffees || coffees;
            coffeesGrid.innerHTML = '';
            
            if (data.length === 0) {
                coffeesGrid.innerHTML = '<p class="no-results">No hay cafés registrados.</p>';
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            data.forEach(coffee => {
                const distributor = distributors.find(d => d.id === coffee.distributorId);
                const distributorName = distributor ? distributor.name : 'Desconocido';
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-title">${escapeHTML(coffee.name)}</h3>
                        <div class="card-subtitle">
                            <i class="fas fa-store"></i>
                            ${escapeHTML(distributorName)}
                        </div>
                        <div class="card-badge">${coffee.scaScore} SCA</div>
                    </div>
                    <div class="card-body">
                        <div class="card-details">
                            <div class="card-detail">
                                <span class="detail-label">Origen</span>
                                <span class="detail-value">${escapeHTML(coffee.origin)}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">Altitud</span>
                                <span class="detail-value">${coffee.altitude} msnm</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">Variedad</span>
                                <span class="detail-value">${escapeHTML(coffee.variety)}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">Proceso</span>
                                <span class="detail-value">${escapeHTML(coffee.process)}</span>
                            </div>
                        </div>
                        <p class="coffee-tasting">${escapeHTML(coffee.tastingNotes)}</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-sm btn-primary view-coffee" data-id="${coffee.id}">
                            <i class="fas fa-eye"></i> Detalles
                        </button>
                        <div>
                            <button class="btn btn-sm btn-primary edit-coffee" data-id="${coffee.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-coffee" data-id="${coffee.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                fragment.appendChild(card);
            });
            
            coffeesGrid.appendChild(fragment);
        }

        function showCoffeeDetail(id) {
            const coffee = coffees.find(c => c.id === id);
            if (!coffee) return;
            
            const distributor = distributors.find(d => d.id === coffee.distributorId);
            const distributorName = distributor ? distributor.name : 'Desconocido';
            
            $('#detail-coffee-name').textContent = coffee.name;
            $('#detail-coffee-origin').textContent = `${coffee.origin} · ${distributorName}`;
            $('#detail-coffee-variety').textContent = coffee.variety;
            $('#detail-coffee-process').textContent = coffee.process;
            $('#detail-coffee-altitude').textContent = `${coffee.altitude} msnm`;
            $('#detail-coffee-roast').textContent = coffee.roastLevel;
            $('#detail-coffee-sca').textContent = coffee.scaScore;
            $('#detail-coffee-price-250').textContent = `€${coffee.price250g}`;
            $('#detail-coffee-price-500').textContent = `€${coffee.price500g}`;
            $('#detail-coffee-price-1kg').textContent = `€${coffee.price1kg}`;
            $('#detail-coffee-tasting').textContent = coffee.tastingNotes;
            
            currentCoffeeDetailId = coffee.id;
            coffeeDetailView.style.display = 'block';
            
            // Scroll to detail view
            coffeeDetailView.scrollIntoView({ behavior: 'smooth' });
        }

        function openDistributorModal(id = null) {
            const modalTitle = $('#distributor-modal-title');
            const form = $('#distributor-form');
            
            if (id) {
                // Edit mode
                modalTitle.textContent = 'Editar Distribuidor';
                const distributor = distributors.find(d => d.id === id);
                
                $('#distributor-id').value = distributor.id;
                $('#distributor-name').value = distributor.name;
                $('#distributor-country').value = distributor.country;
                $('#distributor-region').value = distributor.region;
                $('#distributor-contact').value = distributor.contact;
                $('#distributor-description').value = distributor.description;
            } else {
                // Add mode
                modalTitle.textContent = 'Agregar Distribuidor';
                form.reset();
                $('#distributor-id').value = '';
            }
            
            distributorModal.style.display = 'flex';
        }

        function openCoffeeModal(id = null) {
            const modalTitle = $('#coffee-modal-title');
            const form = $('#coffee-form');
            const distributorSelect = $('#coffee-distributor');
            
            // Populate distributor dropdown
            distributorSelect.innerHTML = '<option value="">Seleccionar distribuidor</option>';
            distributors.forEach(distributor => {
                distributorSelect.innerHTML += `<option value="${distributor.id}">${escapeHTML(distributor.name)}</option>`;
            });
            
            if (id) {
                // Edit mode
                modalTitle.textContent = 'Editar Café';
                const coffee = coffees.find(c => c.id === id);
                
                $('#coffee-id').value = coffee.id;
                $('#coffee-distributor').value = coffee.distributorId;
                $('#coffee-name').value = coffee.name;
                $('#coffee-origin').value = coffee.origin;
                $('#coffee-altitude').value = coffee.altitude;
                $('#coffee-variety').value = coffee.variety;
                $('#coffee-process').value = coffee.process;
                $('#coffee-roast').value = coffee.roastLevel;
                $('#coffee-sca').value = coffee.scaScore;
                $('#coffee-tasting').value = coffee.tastingNotes;
                $('#coffee-price-250').value = coffee.price250g;
                $('#coffee-price-500').value = coffee.price500g;
                $('#coffee-price-1kg').value = coffee.price1kg;
            } else {
                // Add mode
                modalTitle.textContent = 'Agregar Café';
                form.reset();
                $('#coffee-id').value = '';
            }
            
            coffeeModal.style.display = 'flex';
        }

        function handleDistributorSubmit(e) {
            e.preventDefault();
            
            const id = $('#distributor-id').value;
            const name = $('#distributor-name').value;
            const country = $('#distributor-country').value;
            const region = $('#distributor-region').value;
            const contact = $('#distributor-contact').value;
            const description = $('#distributor-description').value;
            
            if (id) {
                // Update existing distributor
                const index = distributors.findIndex(d => d.id === id);
                if (index !== -1) {
                    distributors[index] = { id, name, country, region, contact, description };
                }
            } else {
                // Add new distributor
                const newId = Date.now().toString();
                distributors.push({ 
                    id: newId, 
                    name, 
                    country, 
                    region, 
                    contact, 
                    description 
                });
            }
            
            saveData();
            renderDistributors();
            distributorModal.style.display = 'none';
        }

        function handleCoffeeSubmit(e) {
            e.preventDefault();
            
            const id = $('#coffee-id').value;
            const distributorId = $('#coffee-distributor').value;
            const name = $('#coffee-name').value;
            const origin = $('#coffee-origin').value;
            const altitude = parseFloat($('#coffee-altitude').value);
            const variety = $('#coffee-variety').value;
            const process = $('#coffee-process').value;
            const roastLevel = $('#coffee-roast').value;
            const scaScore = parseFloat($('#coffee-sca').value);
            const tastingNotes = $('#coffee-tasting').value;
            const price250g = parseFloat($('#coffee-price-250').value);
            const price500g = parseFloat($('#coffee-price-500').value);
            const price1kg = parseFloat($('#coffee-price-1kg').value);
            
            if (id) {
                // Update existing coffee
                const index = coffees.findIndex(c => c.id === id);
                if (index !== -1) {
                    coffees[index] = { 
                        id, 
                        distributorId, 
                        name, 
                        origin, 
                        altitude, 
                        variety, 
                        process, 
                        roastLevel, 
                        scaScore, 
                        tastingNotes, 
                        price250g, 
                        price500g, 
                        price1kg 
                    };
                }
            } else {
                // Add new coffee
                const newId = Date.now().toString();
                coffees.push({ 
                    id: newId, 
                    distributorId, 
                    name, 
                    origin, 
                    altitude, 
                    variety, 
                    process, 
                    roastLevel, 
                    scaScore, 
                    tastingNotes, 
                    price250g, 
                    price500g, 
                    price1kg 
                });
            }
            
            saveData();
            renderCoffees();
            coffeeModal.style.display = 'none';
            
            // If we're on the distributors tab, refresh that view too
            if ($('#distributors').classList.contains('active')) {
                renderDistributors();
            }
        }

        function handleGithubConfigSubmit(e) {
            e.preventDefault();
            
            githubConfig.user = $('#github-user').value;
            githubConfig.repo = $('#github-repo').value;
            githubConfig.branch = $('#github-branch').value;
            githubConfig.token = $('#github-token').value;
            githubConfig.autoSync = $('#github-auto-sync').checked;
            githubConfig.syncInterval = parseInt($('#sync-interval').value);
            
            saveGithubConfig();
            showNotification('Configuración de GitHub guardada correctamente.', 'success');
        }

        function deleteDistributor(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este distribuidor? También se eliminarán todos sus cafés.')) {
                // Delete distributor
                distributors = distributors.filter(d => d.id !== id);
                
                // Delete associated coffees
                coffees = coffees.filter(c => c.distributorId !== id);
                
                saveData();
                renderDistributors();
                renderCoffees();
                
                showNotification('Distribuidor eliminado correctamente.', 'success');
            }
        }

        function deleteCoffee(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este café?')) {
                coffees = coffees.filter(c => c.id !== id);
                saveData();
                renderCoffees();
                
                // If we're on the distributors tab, refresh that view too
                if ($('#distributors').classList.contains('active')) {
                    renderDistributors();
                }
                
                showNotification('Café eliminado correctamente.', 'success');
            }
        }

        function searchDistributors() {
            const query = $('#search-distributors').value.toLowerCase();
            if (!query) {
                renderDistributors();
                return;
            }
            
            const filtered = distributors.filter(distributor => 
                distributor.name.toLowerCase().includes(query) ||
                distributor.country.toLowerCase().includes(query) ||
                distributor.region.toLowerCase().includes(query) ||
                distributor.contact.toLowerCase().includes(query) ||
                (distributor.description && distributor.description.toLowerCase().includes(query))
            );
            
            renderDistributors(filtered);
        }

        function searchCoffees() {
            const query = $('#search-coffees').value.toLowerCase();
            if (!query) {
                renderCoffees();
                return;
            }
            
            const filtered = coffees.filter(coffee => {
                const distributor = distributors.find(d => d.id === coffee.distributorId);
                const distributorName = distributor ? distributor.name.toLowerCase() : '';
                
                return (
                    coffee.name.toLowerCase().includes(query) ||
                    coffee.origin.toLowerCase().includes(query) ||
                    coffee.variety.toLowerCase().includes(query) ||
                    coffee.process.toLowerCase().includes(query) ||
                    coffee.roastLevel.toLowerCase().includes(query) ||
                    coffee.tastingNotes.toLowerCase().includes(query) ||
                    distributorName.includes(query)
                );
            });
            
            renderCoffees(filtered);
        }

        function filterDistributors() {
            const countryFilter = $('#filter-country').value;
            const regionFilter = $('#filter-region').value;
            
            let filtered = distributors;
            
            if (countryFilter) {
                filtered = filtered.filter(distributor => distributor.country === countryFilter);
            }
            
            if (regionFilter) {
                filtered = filtered.filter(distributor => distributor.region === regionFilter);
            }
            
            renderDistributors(filtered);
        }

        function filterCoffees() {
            const distributorFilter = $('#filter-distributor').value;
            const processFilter = $('#filter-process').value;
            
            let filtered = coffees;
            
            if (distributorFilter) {
                filtered = filtered.filter(coffee => coffee.distributorId === distributorFilter);
            }
            
            if (processFilter) {
                filtered = filtered.filter(coffee => coffee.process === processFilter);
            }
            
            renderCoffees(filtered);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = themeToggle.querySelector('i');
            
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('latebase-theme', 'dark');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('latebase-theme', 'light');
            }
        }

        function exportData() {
            const dataStr = JSON.stringify({
                distributors,
                coffees,
                exportedAt: new Date().toISOString()
            }, null, 2);
            
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `latebase-export-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Datos exportados correctamente.', 'success');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
                <button class="notification-close"><i class="fas fa-times"></i></button>
            `;
            
            // Add styles for notification
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    .notification {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background-color: var(--surface);
                        color: var(--text-primary);
                        padding: 16px 20px;
                        border-radius: var(--radius-md);
                        box-shadow: var(--shadow-lg);
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        z-index: 1000;
                        animation: slideIn 0.3s ease;
                        max-width: 400px;
                        border-left: 4px solid var(--primary);
                    }
                    
                    .notification-success {
                        border-left-color: var(--success);
                    }
                    
                    .notification-error {
                        border-left-color: var(--error);
                    }
                    
                    .notification-content {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        flex-grow: 1;
                    }
                    
                    .notification-close {
                        background: none;
                        border: none;
                        color: var(--text-secondary);
                        cursor: pointer;
                        font-size: 0.9rem;
                    }
                    
                    .notification-close:hover {
                        color: var(--text-primary);
                    }
                    
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Add to document
            document.body.appendChild(notification);
            
            // Add event listener to close button
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        async function testGithubConnection() {
            const user = $('#github-user').value;
            const repo = $('#github-repo').value;
            const token = $('#github-token').value;
            
            if (!user || !repo || !token) {
                showNotification('Por favor, completa todos los campos de configuración de GitHub.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    showNotification('Conexión a GitHub exitosa. El repositorio existe y el token es válido.', 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    showNotification(`Error al conectar con GitHub: ${errorData.message || response.statusText}`, 'error');
                }
            } catch (error) {
                showNotification('Error al conectar con GitHub: ' + error.message, 'error');
            }
        }

        async function syncWithGithub() {
            if (!githubConfig.token) {
                showNotification('Por favor, configura primero tu token de GitHub.', 'error');
                activateTab('github-config');
                return;
            }
            
            try {
                // Prepare data for export
                const exportData = {
                    distributors,
                    coffees,
                    lastSync: new Date().toISOString()
                };
                
                const content = btoa(JSON.stringify(exportData));
                const message = `LateBase Sync: ${new Date().toLocaleString()}`;
                
                // Check if file exists and get its SHA
                let sha = null;
                try {
                    const response = await fetch(`https://api.github.com/repos/${githubConfig.user}/${githubConfig.repo}/contents/latebase-data.json`, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const fileData = await response.json();
                        sha = fileData.sha;
                    }
                } catch (error) {
                    // File doesn't exist, which is fine for first sync
                }
                
                // Create or update the file
                const response = await fetch(`https://api.github.com/repos/${githubConfig.user}/${githubConfig.repo}/contents/latebase-data.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message,
                        content,
                        sha,
                        branch: githubConfig.branch
                    })
                });
                
                if (response.ok) {
                    showNotification('Datos sincronizados correctamente con GitHub.', 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    showNotification(`Error al sincronizar con GitHub: ${errorData.message || response.statusText}`, 'error');
                }
            } catch (error) {
                showNotification('Error al sincronizar con GitHub: ' + error.message, 'error');
            }
        }

        // Utility function to prevent XSS
        function escapeHTML(str) {
            if (!str) return '';
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Check for saved theme preference
        if (localStorage.getItem('latebase-theme') === 'dark') {
            document.body.classList.add('dark-mode');
            const icon = themeToggle.querySelector('i');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }
    </script>
</body>
</html>
